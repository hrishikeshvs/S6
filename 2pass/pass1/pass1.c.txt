#include<stdio.h>
#include<stdlib.h>
#include<string.h>
FILE *f1,*f2,*f3,*f4;
int locctr,length,start;
char menu[100],code[100],opcode[100],operand[100],label[100];
void main()
{
    f1=fopen("sourcepo.txt","r");
    f2=fopen("inter.txt","w");
    f3=fopen("symtab.txt","w");
    f4=fopen("optab.txt","r");
    fscanf(f1,"%s%s%s",label,opcode,operand);
    if(strcmp(opcode,"START")==0)
    {
        start=atoi(operand);
        locctr=start;
        fprintf(f2,"%s\t%s\t%s\n",label,opcode,operand);
        fscanf(f1,"%s%s%s",label,opcode,operand);

    }
    else
        locctr=0;
    while(strcmp(opcode,"END")!=0)
    {
      fprintf(f2,"%d\t",locctr);
      if(strcmp(label,"**")!=0)
        fprintf(f3,"%s\t%d\n",label,locctr);
      rewind(f4);
      fscanf(f4,"%s",menu);
      while(strcmp(menu,"END")!=0)
      {
          if(strcmp(opcode,menu)==0)
          {
              locctr+=3;

              break;
          }
          fscanf(f4,"%s",menu);
      }
     if(strcmp(opcode,"WORD")==0)
        locctr+=3;
     else if(strcmp(opcode,"RESW")==0)
        locctr+=(3*(atoi(operand)));
     else if(strcmp(opcode,"RESB")==0)
        locctr+=(atoi(operand));
     else if(strcmp(opcode,"BYTE")==0)
    {
        int len;
        len=strlen(operand)-3;
        locctr+=len;
    }
        fprintf(f2,"%s\t%s\t%s\n",label,opcode,operand);
        fscanf(f1,"%s%s%s",label,opcode,operand);
    }
    fprintf(f2,"%d\t%s\t%s\t%s\n",locctr,label,opcode,operand);
    length=locctr-start;
    printf("\nThe length of program: %d",length);
    fclose(f1);
    fclose(f2);
    fclose(f3);
    fclose(f4);
}